#+TITLE: React
ğŸ”´ 

* pnpm + Vite + urql

** pnpm:
npm çš„æ›¿ä»£ é€Ÿåº¦å¿«ï¼Œ ç©ºé—´å ç”¨ç§‘å­¦
** Vite:
app ç”Ÿæˆè„šæ‰‹æ¶
*** æ­¥éª¤ï¼š
pnpm init vite-app gh-explorer --template react
cd gh-explorer
pnpm i
pnpm dev
* ES6 æ¨¡å—åŒ–
+ æš´éœ²ï¼š
  + åˆ†åˆ«æš´éœ²ï¼Œç»Ÿä¸€æš´éœ²
    #+BEGIN_SRC js

    // åˆ†åˆ«æš´éœ²
    export function sum(a, b) {
        return a + b
    }

    // ç»Ÿä¸€æš´éœ²
    function sub(a, b) {
        return a - b
    }
    // export { sub as sub };
    export { sub };
    // ç»Ÿä¸€æš´éœ²
    #+END_SRC
  + é»˜è®¤æš´éœ²
    #+BEGIN_SRC js

    // é»˜è®¤æš´éœ²
    export default {
        mul: function(a, b) {
            return a*b
        },

        div: function(a, b) {
            return a/b
        },

        // æˆ–è€…   ç®€å†™æ–¹å¼
        mul1(a, b) {
            return a*b
        },
        div(a, b) {
            return a/b
        }
    }
    #+END_SRC
+ å¼•å…¥ï¼š
    #+BEGIN_SRC js
        import { sum } from './module1';
        import { sub } from './module2';
        import module3 from './module3';


        console.log(sum(1, 3))
        console.log(sub(3, 1))
        console.log(module3.div(4/2))

    #+END_SRC`
  1. import {} from './xx/xx'
  2. import a from './xxx/xx'

   
* jsx 
** è¯­æ³•è§„åˆ™
+ className
+ {}  é‡Œé¢å†™ js
 âš ï¸æ³¨æ„ï¼š{} é‡Œé¢åªèƒ½å†™è¡¨è¾¾å¼ï¼Œè¨€å¤–ä¹‹æ„ function æˆ–è€… ç®­å¤´å‡½æ•°
 ä¸€ä¸ªè¡¨è¾¾å¼ ä¼šäº§ç”Ÿä¸€ä¸ªå€¼
+ æœ€å¤–å±‚ åªèƒ½åŒ…å«ä¸€ä¸ª æ ‡ç­¾ï¼Œï¼ˆæœ€åå¤–é¢å¥—ä¸€ä¸ª div ä¸€èˆ¬ï¼‰
+ ç»„ä»¶ æ ‡ç­¾é¦–å­—æ¯å¤§å†™
+ 
** ä½œç”¨
ç®€åŒ–åˆ›å»º react è™šæ‹Ÿ dom çš„åˆ›å»ºï¼Œ
åˆ›å»ºçš„å…¶å®æ˜¯è™šæ‹Ÿ dom
** å…¶ä»–
babel å¯ä»¥å§ jsx è½¬åŒ–æˆ js
* react é¢å‘ç»„ä»¶ç¼–ç¨‹
** åˆ›å»ºç»„ä»¶çš„ä¸¤ç§æ–¹å¼
*** å·¥å‚å‡½æ•°å®šä¹‰ç»„ä»¶
è¿™ç§ ç»„ä»¶å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•° (å‡½æ•°åé¦–å­—æ¯å¤§å†™), åœ¨ jsx é‡Œé¢ ç”¨æ ‡ç­¾è°ƒç”¨, jsx æ¸²æŸ“ è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼
#+BEGIN_SRC js react
function Mycoponent() {
  return <h2>fuck</h2>
}

# html
<Mycoponent/>

#+END_SRC
*** es6 ç±»ç»„ä»¶
#+BEGIN_SRC js react
class Myconponent2 extends React.Component {
  // æ„é€ å™¨ new çš„æ—¶å€™ åˆå§‹åŒ–ç”¨
  constructor(a) {
    super(a)
  }

  // é‡å†™ä»çˆ¶ç±»ç»§æ‰¿çš„ render
  render() {
    return <h2>es6 ç±»ç»„ä»¶åˆ›å»ºçš„ å¤æ‚ç»„ä»¶</h2>
  }
}

#+END_SRC
** ç»„ä»¶ä¸‰å¤§å±æ€§
*** state
ç‰¹ç‚¹ state å°±å« stateï¼Œ 1.ä¸èƒ½ç›´æ¥æ›´æ–°ï¼Œ 2.ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œ ï¼ˆå€ŸåŠ© setState æ–¹æ³•ï¼‰
Component é‡Œé¢ è‡ªå·±å®šä¹‰çš„æ–¹æ³• æ‹¿ä¸åˆ° this éœ€è¦ bind this ï¼ˆreact åº•å±‚å¼Šç«¯ï¼Œ vue æ²¡è¿™ä¸ªé—®é¢˜ï¼‰
#+BEGIN_SRC js react

class Weather extends React.Component {
  constructor(a) {
    super(a)
    this.state = {isHot:true}
    this.changeWeather = this.changeWeather.bind(this)
  }

  render() {
    let { isHot } = this.state

    return <h1 onClick={this.changeWeather}>ä»Šå¤©å¤©æ°”å¾ˆ{isHot ? 'çƒ­' : 'å†·'}</h1>
  }

  // è‡ªå·±å†™çš„æ–¹æ³•ï¼Œ é‡Œé¢æƒ³ä½¿ç”¨ this ä¼šæŠ¥ undefinedï¼Œ å¿…é¡»ç”¨ bind (react åº•å±‚çš„é—®é¢˜ï¼Œ vue æ²¡æœ‰è¿™ä¸ªé—®é¢˜)
  changeWeather() {
    // console.log(this)
    // this.state.isHot = !this.state.isHot
    // ç»„ä»¶å®ä¾‹çš„ state: 1. ä¸èƒ½ç›´æ¥ä¿®æ”¹ 2.ä¸èƒ½ç›´æ¥æ›´æ–°
    this.setState({isHot: !this.state.isHot})

  }
}

#+END_SRC

**** setState
+ setState å±äºæ›´æ–°æ“ä½œï¼Œ(æ›´æ–°çš„ å¯èƒ½ä¸æ˜¯å…¨éƒ¨èˆ’é€‚åŒ–çš„å˜é‡)
+ å¿…é¡»æ›´æ–°åˆå§‹åŒ–å­˜åœ¨è¿‡çš„å˜é‡
**** bind(this)
åœ¨ Component ä¸­çš„è‡ªå·±å®šä¹‰çš„æ–¹æ³• this  è®¿é—®ä¸åˆ°è¿™ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥éœ€è¦ ç”¨ bind(this)
**** state çš„ç®€å†™æ–¹å¼
+ åˆ©ç”¨äº† class é‡Œé¢ ç›´æ¥å®šä¹‰å±æ€§ï¼Œå’Œç®­å¤´å‡½æ•°é‡Œé¢æ²¡æœ‰ thisï¼Œæ²¡æœ‰ this ä¼šå‘å¤–æ‰¾çš„ç‰¹ç‚¹ï¼Œè¿™æ—¶å°±æ‰¾åˆ°äº† class çš„ this
+ ç›¸å½“äº ä¸ä½¿ç”¨ constructor æ„é€ å™¨
  
#+BEGIN_SRC js react
class Weather extends React.Component {
    // class é‡Œé¢ç›´æ¥å®šä¹‰ å˜é‡å=xxx thiså¯ä»¥ç›´æ¥è®¿é—®åˆ°
  state = {isHot:true}

  render() {
    let { isHot } = this.state

    return <h1 onClick={this.changeWeather}>ä»Šå¤©å¤©æ°”å¾ˆ{isHot ? 'çƒ­' : 'å†·'}</h1>
  }

// åˆ©ç”¨ å˜é‡=åŒ¿åå‡½æ•°ï¼Œä½¿å˜é‡åå¯ä»¥è¢«this è®¿é—®åˆ°ï¼Œè€Œä¸” åŒ¿åå‡½æ•°é‡Œé¢æœ¬èº«æ²¡æœ‰thisï¼Œä½†æ˜¯åŒ¿åå‡½æ•°çš„this å’Œä»–å¤–å±‚çš„this ä¸€è‡´
  changeWeather = () => {
    this.setState({isHot: !this.state.isHot})

  }
}

#+END_SRC
*** props
ç¿»è¯‘è¿‡æ¥ å‚æ•°çš„æ„æ€
å…¶å®å°±æ˜¯ jsx ä¸­ çš„ç»„ä»¶åœ¨è°ƒç”¨å¹¶ä¼ å€¼çš„æ—¶å€™ class å†…éƒ¨å¯ä»¥è®¿é—®åˆ°è¿™éƒ¨åˆ†å€¼çš„ä¸€ç§é˜²æ–¹å¼
#+BEGIN_SRC js react
import PropTypes from 'prop-types';

<Person name="kobe" age={18} sex="ç”·"/>


class Person extends React.Component{
  render() {
    let { name, age, sex } = this.props
    return (
      <ul>
        <li>{name}</li>
        <li>{sex}</li>
        <li>{age}</li>
      </ul>
    )
  }
}

// è®¾å®š props type å±æ€§ å’Œé»˜è®¤å€¼
Person.propTypes = {
  name: PropTypes.string.isRequired,
    age: PropTypes.number,
    sex: PropTypes.string,
}
Person.defaultProps = {
  name: 'Stranger',
  age: 10,
  sex: "ä¸ç”·ä¸å¥³",
};

#+END_SRC

**** props çš„ç®€å†™
#+BEGIN_SRC js react
class Person extends React.Component{
  static propTypes = {
    name: PropTypes.string.isRequired,
    age: PropTypes.number,
    sex: PropTypes.string,
  }

  static defaultProps = {
    age: 10,
    sex: "ä¸ç”·ä¸å¥³",
  }

  render() {
    let { name, age, sex } = this.props
    return (
      <ul>
        <li>{name}</li>
        <li>{sex}</li>
        <li>{age}</li>
      </ul>
    )
  }
}

#+END_SRC


**** props ä¼ å‚çš„ç®€å†™
æ­£å¸¸æ¥è¯´ ã€‚ã€‚ã€‚ è§£åŒ… åªèƒ½ç”¨ è§£åŒ…æ•°ç»„ï¼Œ ä½†æ˜¯ å¦‚æœç”¨ {} é˜”ä¸Šè§£åŒ…  å¯ä»¥è§£åŒ…å¯¹è±¡
#+BEGIN_SRC js react

// æ­£å¸¸
<Person name="kobe" age={18} sex="ç”·"/>

// è§£åŒ…
let person2 = {name:"sb", age:18, sex:"å¥³"}
<Person {...person2}/>

#+END_SRC
*** ref
ref å’Œ refs å°±æ˜¯ç±»ä¼¼ id ä¸€æ ·ç»™æ ‡ç­¾åšæ ‡è®°ï¼Œæ–¹ä¾¿æ‰¾åˆ°
ref æ ‡è®°ï¼Œ this.refs æ‹¿åˆ°æ ‡è®°çš„æ ‡ç­¾
ğŸ”´æ³¨æ„ï¸ï¼šèƒ½ä¸ç”¨å°±ä¸ç”¨ï¼Œevent æœ‰æ—¶å€™ä¹Ÿå¯ä»¥
#+BEGIN_SRC js react
class MyComponent extends React.Component{

  clickButton = () => {
    alert(this.refs.input1.value)
  }

  blurHandler = (event) => {
    alert(event.target.value)
  }

  render() {
    return (
      <div>
        // æ³¨æ„ è¿™ä¸ªæ–¹å¼å·²ç»è¢«é—å¼ƒ
        <input name="" type="text" ref="input1"/>&nbsp;
        <button onClick={this.clickButton}>click</button>&nbsp;
        <input name="" type="text" placeholder='ç‚¹ç‚¹ç‚¹ç‚¹' onBlur={this.blurHandler}/>
      </div>
    )
  }
}

#+END_SRC
**** ref æ–°å†™æ³•(åŸºäºå›è°ƒ)

åŸç†ï¼šreact ä¼šè°ƒç”¨ refï¼Œ å¹¶æŠŠå½“å‰èŠ‚ç‚¹ ä¼ å…¥ç»™ ref è¡¨è¾¾å¼, ç„¶åæ‰‹åŠ¨æŒ‡å®šå˜é‡ èµ‹å€¼ç»™å½“å‰èŠ‚ç‚¹
<input type="text" ref={ (input) => {this.input1 = input} }/>&nbsp;
<input type="text" ref={ input => this.input1 = input }/>&nbsp;

#+BEGIN_SRC js react
class MyComponent extends React.Component{

  clickButton = () => {
    alert(this.myTargetInput.value)
  }

  blurHandler = (event) => {
    alert(event.target.value)
  }

  render() {
    return (
      <div>
        <input type="text" ref={ input => this.myTargetInput = input }/>&nbsp;
        <button onClick={this.clickButton}>click</button>&nbsp;
        <input type="text" placeholder='ç‚¹ç‚¹ç‚¹ç‚¹' onBlur={this.blurHandler}/>
      </div>
    )
  }
}

#+END_SRC
**** ref æ–°å†™æ³•(åŸºäº createRef)
åˆ©ç”¨ React.createRef() åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼ˆä¸“ç”¨ï¼‰

#+BEGIN_SRC js react
class MyComponent extends React.Component{

  myRef = React.createRef()

  clickButton = () => {
    alert(this.myRef.current.value)
  }

  blurHandler = (event) => {
    alert(event.target.value)
  }

  render() {
    return (
      <div>
        <input type="text" ref={ this.myRef }/>&nbsp;
        <button onClick={this.clickButton}>click</button>&nbsp;
        <input type="text" placeholder='ç‚¹ç‚¹ç‚¹ç‚¹' onBlur={this.blurHandler}/>
      </div>
    )
  }
}
#+END_SRC
** ç»„ä»¶çš„ç»„åˆ
ç»„åˆ å†™ä¸ª todo list ç‚¹ button å°±æ·»åŠ ä¸€ä¸ª todo list
#+BEGIN_SRC js react
class MyApp extends React.Component{
  state = {
    todoArr: ['åƒé¥­', 'ç¡è§‰', 'æ‰“è±†è±†']
  }
  render() {
    let {todoArr} = this.state
    return (
      <div>
        <h1>yidvslkdfjskfdj</h1>
        <Add updateArr={this.updateTodoArr} arrLength={todoArr.length}/>
        <List arr={ todoArr }/>
      </div>
    )
  }

  // state åœ¨å“ªé‡Œ æ›´æ–°çš„æ–¹æ³•å°±åœ¨å“ªé‡Œ
  updateTodoArr = (newstr) => {
    // å¿…é¡»é‡æ–°èµ‹å€¼ï¼Œ åŸstate ä¸å¯æ”¹åŠ¨
    let newarr = this.state.todoArr
    newarr.push(newstr)
    this.setState(newarr)
  }
}

class Add extends React.Component{
  render() {
    let { arrLength } = this.props
    return (
      <div>
        <input type="text" ref={ (input) => { this.addContent = input } }/>
      <button onClick={this.buttonHandler}>add #{arrLength}</button>
      </div>
    )
  }

  // ä¸èƒ½ç›´æ¥æ›´æ–° å­˜åœ¨äºçˆ¶çº§çš„ state, å°±åˆ©ç”¨ çˆ¶çº§ç»™çš„ æ›´æ–°æ–¹æ³•æ›´æ–° state
  buttonHandler = () => {
    let { updateArr } = this.props
    updateArr(this.addContent.value)
    this.addContent.value = ''
  }
}

class List extends React.Component{
  render() {
    let { arr } = this.props
    return (
      <ul>
      {
        arr.map((item, index)=>{
          return <li key={index}>{item}</li>
        })
      }
      </ul>
    )
  }
}
#+END_SRC
** å—æ§ç»„ä»¶ éå—æ§ç»„ä»¶
å°±çœ‹æ˜¯å¦ è‡ªåŠ¨ç»´æŠ¤ value åˆ° stateï¼Œ ç»´æŠ¤åˆ° state çš„å°±æ˜¯å—æ§ç»„ä»¶
** ç”Ÿå‘½å‘¨æœŸå‡½æ•°(é’©å­)(æ—§çš„)
+ ğŸŸ¢ æŒ‚è½½ componentDidMount()  
  å¼€å®šæ—¶å™¨ï¼Œ å‘ ajax è¯·æ±‚
+ ğŸŸ¢ å¸è½½ componentWillUnmount()
  åšä¸€äº›æ”¶å°¾æ€§çš„å·¥ä½œ 
+ componentWillReceiveProps()    ä»ç¬¬äºŒæ¬¡å¼€å§‹ç®—(çˆ¶ç»„ä»¶æ›´æ–°çŠ¶æ€çš„æ—¶å€™)
+ forceUpdate()   å¼ºåˆ¶æ›´æ–°
+ shouldComponentUpdate()  
+ æ›´æ–° componentWillUPdate()
*** æµç¨‹
componentWillMount()   ->   render()  -> componentDidMount()
componentWillUpdate()  ->   render()  -> componentDidUpdate()
*** å°†è¦åºŸå¼ƒçš„é’©å­
ä¸€å…± 4 ä¸ª will åºŸå¼ƒäº† 3 ä¸ªï¼Œ å‰©ä¸€ä¸‹ componentWillUnmount
+ componentWillMount()
+ componentWillReceiveProps()
+ componentWillUpdate()
***  æ–°æµç¨‹
**** getDerivedStateFromProps
+ ğŸ”´ getDerivedStateFromProps
  + should be a static method
  + must have return, null or object, return çš„å¯¹è±¡ä¼šå¯¹ state åšæ›´æ–°, æ²¡é‡åè¿½åŠ ï¼Œæœ‰é‡åæ›´æ–°
  + ç”¨äºå–ä»£ willMount, willUpdate
#+BEGIN_SRC js react 
static getDerivedStateFromProps(props, state){
    return {a: 1}
}
#+END_SRC
**** getsnapshotbeforeupdate

**** æŒ‚è½½æ—¶
constructor -> getDerivedStateFromProps -> render -> componentDidMount
**** æ›´æ–°æ—¶
getDerivedStateFromProps -> shouldComponentUpdate -> render -> getsnapshotbeforeupdate -> componentDidUpdate
**** å¸è½½æ—¶
componentWillUnmount
** react ä¸­çš„ key


