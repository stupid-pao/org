#+TITLE: Git Record Merge
ğŸš€ ğŸ¥ ğŸ¾ ğŸª€ ğŸ¥ ğŸ¥Š ğŸ¯ ğŸ¦  ğŸŒˆï¸
* music 
** [[https://www.youtube.com/watch?v=zvkHSDO5VQ8][ä¸ƒé‡Œé¦™]] 
* ğŸŒˆï¸ code snipets
** upload picture use base64
#+BEGIN_SRC python
import base64
from django.core.files.base import ContentFile
from enrichment.models import KlassSchedule

klass_schedule = KlassSchedule()
covers = cover.split(',')
content_name = covers[0].split(';')[0]
cover_name = 'cover.{}'.format(content_name.split('/')[-1])
cover_file = ContentFile(base64.b64decode(covers[1]))
klass_schedule.cover.save(cover_name, cover_file, False)

#+END_SRC

** export csv
#+BEGIN_SRC python

url(r'^withdrawn/xls/$', withdrawn_xls, name='withdrawn-xls'),

@login_required
def withdrawn_xls(request):
    today = get_current_date()
    date_from = try_get_date(request.GET, 'date_from', '%d-%m-%Y', get_start_of_month(today))
    date_to = try_get_date(request.GET, 'date_to', '%d-%m-%Y', get_end_of_month(today))
    enrichment_center = get_center_for_user(request.user)
    students = Student.objects.filter(leave_date__isnull=False, enrichment_center=enrichment_center,
                                      leave_date__range=(date_from, date_to)).order_by('-leave_date').distinct()
    csv_data = []
    title_list = [
        'ID',
        'Child Name',
        'Gender',
        'Date Of Birth',
        'Emergency Contact',
        'Emergency Contact No.',
        'Source',
        'Class',
        'Left / Total',
        'Status',
        'Withdrawn Date',
    ]

    today = get_current_date()
    csv_data.append(title_list)
    for student in students:
        student_status = ''
        if student.leave_date and student.leave_date < today:
            student_status = _('Withdrawn')
        elif student.leave_date and student.leave_date >= today:
            student_status = _('Pre-withdrawn')
        student_id = student.pk
        student_name = student.fullname
        gender = student.get_gender_display()
        birth = student.date_of_birth.__format__('%d-%m-%Y')
        contact = student.emergency_contact
        contact_no = student.emergency_contact_no
        source = student.get_source_display()
        cls = student.get_klassschedules_name()
        left_total = '{}/{}'.format(student.left_lessons,student.total_lessons)
        withdrawn_date = student.leave_date
        tmp_data = [student_id,student_name,gender,birth,contact,contact_no,source,cls,left_total,student_status,withdrawn_date]
        csv_data.append(tmp_data)
    echoer = Echo()
    writer = UnicodeWriter(echoer)

    def csv_itertor():
        yield codecs.BOM_UTF8
        for column in csv_data:
            yield writer.writerow(column)
    a = (tmp for tmp in csv_itertor())
    response = StreamingHttpResponse(
        a,
        content_type="application/octet-stream"
    )
    response['Content-Disposition'] = 'attachment;filename="{}"'.format("withdrawn.csv")
    return response

#+END_SRC
** push notification to phone use celery
*** def push_broadcast_schedule_notify(broadcast_schedule_id, message):
** raise exception to show line number
#+BEGIN_SRC python
import traceback

traceback.print_exc()

#+END_SRC
** orm
*** orm æ‰¹é‡åˆ›å»º bulk_create()

Happening.objects.bulk_create(happening_list, batch_size=10)
+ batch_size æ§åˆ¶æ¯æ‰¹æ•°é‡
  
*** delete many to many fields
annoncement.students.clear()
*** delete related_foreighing key
klass_schedule.klassschedule_times.all().delete()


** Taidii code
*** convert pic to pdf api
å‘ç”Ÿåœ¨æœåŠ¡å™¨è½¬æ¢å®Œæˆå å›è°ƒ taidii çš„æœåŠ¡å™¨
**** def handler_convert_app(app_name, upload_status=0, *args):

*** è·å– user role name ä»¥åˆ¤æ–­æ˜¯ teacher or principal or guradian
#+BEGIN_SRC python
from taidiiuser.models improt TidiiUser

role_name = TaidiiUser.get_taidii_user_property(request.user, 'role_name')
center = TaidiiUser.get_taidii_user_property(request.user, 'center')

#+END_SRC
*** enrichemt é€šè¿‡ klassschedule è·å–å­¦ç”Ÿ
#+BEGIN_SRC python
klass_schedule = list(KlassSchedule.objects.filter(Q(date_to=None)|Q(date_to__gte=today), 
                                date_from__lte=today, center=happening.center).values_list('id', flat=True).distinct())
sk_schedule = list(StudentKlassSchedule.objects.filter(Q(end_date=None)|Q(end_date__gte=today), enroll_date__lte=today, 
                            klassschedule__in=klass_schedule).values_list('id', flat=True).distinct())
students = Student.objects.filter(student_klassschedules__in=sk_schedule).distinct()


#+END_SRC
* ğŸ¥ pull request record
** hq happenings
*** https://github.com/Taidii/taidiiv2/pull/7161
** online teaching
*** https://github.com/Taidii/taidiiv2/pull/7208/commits

* feature/zoomintegration
* feature/myobChanges_992  			dev: âœ…
myob å¯¼å‡ºæ”¹åŠ¨
* feature/merchandise_translate_1021
- [Enrichment] ç¿»è¯‘ [Mentalmatics] è·¯å¾„ï¼šResource Management - Merchandise Management(ç¿»è¯‘ä¸Šä¸€é¡µ ä¸‹ä¸€é¡µ)
- dev: âœ…
* feature/enrichmentFinanceAddRefundList_974  ğŸ“
- dev: âœ…
** DONE è¿˜éœ€è¦åŠ ä¸ª refund å·ç  æ²¡åš
** DONE void åŠŸèƒ½
** DONE refund no. ä¸æ˜¾ç¤º
** 
** [?] credit no æ˜¾ç¤ºæœ‰é—®é¢˜ï¼Ÿï¼Ÿ
* feature/studentAttendanceAddRemarks_994 
** dev: âœ…
** æœºæ„ Student Attendance æ¨¡å—ä¸­ï¼Œåœ¨ Remarks æ å’Œ Action æ ä¸­é—´åŠ å…¥æ–°çš„ä¸€æ ï¼Œå«åš Additional Remarksï¼Œ å¯ä»¥è¿›è¡Œä¿®æ”¹
** æ›´æ–° ä½¿ç”¨ js + form æ¨¡ç‰ˆ + ajax é€šä¿¡  é‡å®šå‘ url  location.search
* feature/physicalTestTranslation   dev_cn: âœ…
** åŸºæœ¬é—®é¢˜
- éœ€è¦æƒé™ physical å¼€å¤´
- éœ€è¦ dev.cn database   è´¦å·ï¼šdemo china_cn
- è‹±æ–‡æ’ç‰ˆæœ‰é—®é¢˜
- [[http://localhost:8000/physicaltest-report/overall/analysis/]]
** æŠ€å·§è®°å½•
#+BEGIN_SRC python
from django.utils import translation

# è·å–å½“å‰è¯­è¨€
translation.get_language()

# æ¿€æ´»æŸç§è¯­è¨€çš„ç¿»è¯‘
user_language = "en_US"
translation.activate(user_language)

# éœ€å›½é™…åŒ–çš„ä»£ç ç”¨è¿™ä¸ªï¼Œ html ç”¨ trans åŒ…è£¹ï¼Œ js ç”¨ gettext()
from django.utils.translation import ugettext_lazy as _

#+END_SRC
** database é‡Œé¢çš„ç¿»è¯‘ï¼š 
*** physicaltest_physicalcategory
| name          | eng                                         | measure |
|---------------+---------------------------------------------+---------|
| "èº«é«˜"        | "Height",                                   |         |
| "ä½“é‡"        | "Weight"                                    |         |
| "ç«‹å®šè·³è¿œ"    | "Standing Long Jump",                       |         |
| "ç½‘çƒæŠ›æ·"    | "Tennis Ball ThrowStanding Long Jump",      |         |
| "10 ç±³æŠ˜è¿”è·‘" | "10-meter Shuttle Run",                     |         |
| "åä½ä½“å‰å±ˆ"  | "Sitting Body Flexion10-meter Shuttle Run", |         |
| "å¹³è¡¡æœ¨"      | "Balance Beam",                             |         |
| "åŒè„šè¿ç»­è·³"  | "Skip Jump",                                |         |
*** physicaltest_guardiansuggestion 
- ç©ºçš„
*** physicaltest_InterventionPlan 
** report pdf url
- physicaltest.views.student_report_pdf(
- student_report_for_print(       /è¿™ä¸ªå°±æ˜¯å¯¼å‡º html çš„æ¨¡ç‰ˆ/
- http://localhost:8000/physicaltest-report/student_report_for_print/87661/267/

* feature/myobChanges    ğŸŒˆï¸update  dev: âœ…
* feature/edg_feature      æ–°çš„ edg åˆå¹¶åˆ° master åçš„ 
** old branch
feature/new_EDG_task
*** feature/1783_zpj_hq_calendar    hq å¢åŠ  event  è¿™ä¸ªå¯ä»¥ç”¨ âœ…
*** feature/1784_stock_page
*** feature/XQ_1564_block_close_date   æ¢è¯¾/è¡¥è¯¾æ—¶ï¼Œå±è”½å­¦æ ¡å…³é—­çš„æ—¥æœŸ

** TODO resource management enrichment æƒé™æœ‰é—®é¢˜
- æœ¬åœ°æ²¡æœ‰æƒé™ä¹Ÿå¯ä»¥è®¿é—® setting  ï¼Œæœªå‘ç°é—®é¢˜
** ä¸€å¼  excel è¡¨æ ¼éœ€è¦åš 
** migration file record 
- finance/migrations/0061_auto__add_field_centerfinance_bold.py
- resourcemanagement/migrations/0014_auto__add_packagehistory__add_itempackage__add_package.py
- students/migrations/0023_auto__add_field_student_referral.py
* feature/hq_discountCreateChanges_1041  dev: âœ…
SCHEDULED: <2020-03-22 Sun 14:00>
- [Finance] ç»Ÿä¸€ HQ ä¸ Centre çš„åˆ›å»º Discount é¡µé¢[GEH]
* feature/estore     ï¸ğŸš€ ğŸ¯ ğŸ¦   benny use GenericViewSet
* feature/hq_happenings      hq åˆ‡æ¢å­¦æ ¡æ˜¾ç¤ºæ•°æ® (ğŸ¯ celery async)
- æ–°å¢ hq_happenings & annoncement
- create update æ¥å£æ›´æ–°
- ä¹‹å‰çš„å­¦æ ¡ä¸èƒ½ç­›é€‰å‡ºæ¥å½“å‰ hq create çš„æ•°æ®
** api æ¥å£
åˆ›å»º happenings   /happenings/center/create/    	happenings.views.HappeningCreateView
åˆ›å»º annoucement  /announcement/create/         announcement.views.AnnouncementCreateView

** DONE ä¸å½±å“ä¹‹å‰æ•°æ®
** permission record
- {% if user|hq_has_permission:'happenings' or user|hq_has_permission:'announcement' or user|hq_has_permission:'survey' %}
- app_name = 'happenings'
  permission_name = 'manage'
  
** summary

*** upload file convert åå›è°ƒä¿å­˜é—®é¢˜
taidii/convert/views.py
def save2happening(center_id, db_name, db_id, file_url, image_list, upload_status=Happening.ING):
* feature/diilearn
* feature/hq_enrichment_report_1105
** æƒé™
 is_hq_permission_enable
enrolment:enrolment_student_report

